<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Blogs For Linux Kernel">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Blogs For Linux Kernel">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Bruce Song">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Blogs For Linux Kernel</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Blogs For Linux Kernel</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/01/06/kernel/read_assembly_on_x86_64/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Bruce Song">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blogs For Linux Kernel">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/01/06/kernel/read_assembly_on_x86_64/" class="post-title-link" itemprop="url">How to read assembly and stack data on x86_64</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-01-06 00:00:00" itemprop="dateCreated datePublished" datetime="2025-01-06T00:00:00+08:00">2025-01-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-02-10 11:50:36" itemprop="dateModified" datetime="2025-02-10T11:50:36+08:00">2025-02-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h2><p>1 <a href="#Why">Why need to read assembly?</a><br>2 <a href="#Essential">Essential Knowledge</a><br>&nbsp;&nbsp;&nbsp;&nbsp;2.1 <a href="#Instructions">The most used instructions</a><br>&nbsp;&nbsp;&nbsp;&nbsp;2.2 <a href="#Registers">x86_64 Registers</a><br>&nbsp;&nbsp;&nbsp;&nbsp;2.3 <a href="#Convention">Calling  Conventions</a><br>&nbsp;&nbsp;&nbsp;&nbsp;2.4 <a href="#AssemblySection">The most common sections of a function in terms of assembly</a><br>3 <a href="#Stack">Understand the data of stack by assembly</a><br>&nbsp;&nbsp;&nbsp;&nbsp;3.1 <a href="#StackLayout">Understand  the data layout of stack</a><br>&nbsp;&nbsp;&nbsp;&nbsp;3.2 <a href="#StackImage">A layout of stack generally looks like</a><br>&nbsp;&nbsp;&nbsp;&nbsp;3.3 <a href="#FrameData">One whole data layout of a frame</a><br>&nbsp;&nbsp;&nbsp;&nbsp;3.4 <a href="#StackAssembly">Understand the layout over assembly</a><br>&nbsp;&nbsp;&nbsp;&nbsp;3.5 <a href="#Purpose">The purpose of understanding stack layout</a><br>4 <a href="#Determine">Determine what the issue is</a><br>&nbsp;&nbsp;&nbsp;&nbsp;4.1 <a href="#SoftwareBug">Understand trap instruction</a><br>&nbsp;&nbsp;&nbsp;&nbsp;4.2 <a href="#Non-SoftwareBug">Not A Software Bug</a><br>&nbsp;&nbsp;&nbsp;&nbsp;4.3 <a href="#Deadlock">A Deadlock</a><br>5 <a href="#Reference">References</a></p>
<h3 id="1-Why-need-to-read-assembly"><a href="#1-Why-need-to-read-assembly" class="headerlink" title="1 Why need to read assembly? "></a>1 Why need to read assembly? <a id="Why"></a></h3><ul>
<li>Understand what data gets corrupted.</li>
<li>Understand how a deadlock take places and how resources get involved.</li>
<li>Understand if an issue is from App&#x2F;Kernel or hardware&#x2F;microcode or virtualization.</li>
</ul>
<h3 id="2-Essential-Knowledge"><a href="#2-Essential-Knowledge" class="headerlink" title="2 Essential Knowledge"></a>2 Essential Knowledge<a id="Essential"></a></h3><h4 id="2-1-The-most-used-instructions"><a href="#2-1-The-most-used-instructions" class="headerlink" title="2.1 The most used instructions "></a>2.1 The most used instructions <a id="Instructions"></a></h4><ul>
<li><code>push/pop</code><br>Operate data on stack, <code>push</code> puts data on stack, which increases the stack size. <code>pop</code> gets data from stack, which decrease the stack size. The amount of push instructions reflects part size of stack.</li>
<li><code>mov</code><br>Move data from the source of register&#x2F;memory to the destination of register&#x2F;memory</li>
<li><code>test</code><br>Determine if a value is 0 or not. If the result is <code>0</code>, the <code>ZF</code> is set to <code>1</code>, otherwise set to <code>0</code>.  In general, there is a jump instruction following <code>test</code> instruction. By checking <code>ZF</code> flags to confirm if jump to another position.</li>
<li><code>jz/jnz/je/jne</code><br>In general, it follows a test or a cmp command. For <code>jz/je</code>, if <code>ZF</code> is 1, then jump, for <code>jnz/jne</code>, if <code>ZF</code> is 0, then jump.</li>
<li><code>cmp</code><br>The comparison is performed by subtracting the second operand from the first operand and then setting the status flags in the same manner as the <code>sub</code> instruction. Like <code>test</code> , followed by a jump instruction.</li>
<li><code>jmp</code><br>An unconditional jump instruction.</li>
<li><code>call</code><br>Call a function with prepared arguments(See <a href="#Convention">Calling  Conventions</a>). We can check how the dataflow is by the arguments passed to the function. Put the return address of caller, which increases the stack size silently.</li>
<li><code>ret</code><br>Return from callee to caller. Pop up return address and run it.</li>
</ul>
<h4 id="2-2-x86-64-Registers"><a href="#2-2-x86-64-Registers" class="headerlink" title="2.2 x86_64 Registers "></a>2.2 x86_64 Registers <a id="Registers"></a></h4><p>The usage of registers</p>
<table>
<thead>
<tr>
<th>Registers</th>
<th>Usage</th>
<th>Saved across calls</th>
</tr>
</thead>
<tbody><tr>
<td>%rax</td>
<td>Temporary register; return first 8 bytes after function call</td>
<td>No</td>
</tr>
<tr>
<td>%rbx</td>
<td>Callee-saved register, used to save temporary data</td>
<td>Yes</td>
</tr>
<tr>
<td>%rcx</td>
<td>Used to pass the 4th argument to functions(not for syscall)</td>
<td>No</td>
</tr>
<tr>
<td>%rdx</td>
<td>Used to pass the 3rd parameter to functions</td>
<td>No</td>
</tr>
<tr>
<td>%rbp</td>
<td>Optionally used to save the pointer of frame bottom for stack; callee-saved register</td>
<td>Yes</td>
</tr>
<tr>
<td>%rsp</td>
<td>Stack pointer, always point to the top of stack</td>
<td>Yes</td>
</tr>
<tr>
<td>%rdi</td>
<td>Used to pass the 1st argument to functions.</td>
<td>No</td>
</tr>
<tr>
<td>%rsi</td>
<td>Used to pass the 2nd argument to functions.</td>
<td>No</td>
</tr>
<tr>
<td>%r8</td>
<td>Used to pass the 5th argument to functions.</td>
<td>No</td>
</tr>
<tr>
<td>%r9</td>
<td>Used to pass the 6th argument to functions.</td>
<td>No</td>
</tr>
<tr>
<td>%r10</td>
<td>Temporary register; used to pass the 4th argument to syscall.</td>
<td>No</td>
</tr>
<tr>
<td>%r11</td>
<td>Temporary register</td>
<td>No</td>
</tr>
<tr>
<td>%r12-%r15</td>
<td>Callee-saved register.</td>
<td>Yes</td>
</tr>
<tr>
<td>%rip</td>
<td>Used to save the address of current instruction</td>
<td>No</td>
</tr>
<tr>
<td>%gs</td>
<td>Used to save percpu data pointer inside of linux kernel.</td>
<td></td>
</tr>
</tbody></table>
<h4 id="2-3-Calling-Conventions"><a href="#2-3-Calling-Conventions" class="headerlink" title="2.3 Calling  Conventions "></a>2.3 Calling  Conventions <a id="Convention"></a></h4><p>In x86_64(or AMD64), there are 6 registers used to pass arguments during a function call, which are %rdi, rsi%, rdx%, rcx%, r8% and r9% for both user and kernel space(Not for syscall, which uses r10% to pass the 4th argument).  See the details in <a href="#Registers">x86_64 registers</a> section.</p>
<h4 id="2-4-The-most-common-sections-of-a-function-in-terms-of-assembly"><a href="#2-4-The-most-common-sections-of-a-function-in-terms-of-assembly" class="headerlink" title="2.4 The most common sections of a function in terms of assembly "></a>2.4 The most common sections of a function in terms of assembly <a id="AssemblySection"></a></h4><ul>
<li><p>The entrance section of a function </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;migrate_swap&gt;:      nopl   0x0(%rax,%rax,1) [FTRACE NOP]</span><br><span class="line">&lt;migrate_swap+5&gt;:    push   %r14</span><br><span class="line">&lt;migrate_swap+7&gt;:    mov    %rsi,%r14</span><br><span class="line">&lt;migrate_swap+10&gt;:   push   %r13</span><br><span class="line">&lt;migrate_swap+12&gt;:   mov    %rdi,%r13</span><br><span class="line">&lt;migrate_swap+15&gt;:   push   %r12</span><br><span class="line">&lt;migrate_swap+17&gt;:   mov    %edx,%r12d</span><br><span class="line">&lt;migrate_swap+20&gt;:   push   %rbp</span><br><span class="line">&lt;migrate_swap+21&gt;:   mov    %ecx,%ebp</span><br><span class="line">&lt;migrate_swap+23&gt;:   push   %rbx</span><br><span class="line">&lt;migrate_swap+24&gt;:   sub    $0x18,%rsp</span><br></pre></td></tr></table></figure>
<p>As we can see, the entrance of the function is almost to operate stack, <code>push</code> instruction to save prior the values of some registers. And <code>sub</code> instruction is used to preserve extra stack space for local variables or temporary purpose.</p>
</li>
<li><p>The exit section of a function</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;migrate_swap+259&gt;:  add    $0x18,%rsp</span><br><span class="line">&lt;migrate_swap+263&gt;:  mov    $0xffffffea,%eax</span><br><span class="line">&lt;migrate_swap+268&gt;:  pop    %rbx</span><br><span class="line">&lt;migrate_swap+269&gt;:  pop    %rbp</span><br><span class="line">&lt;migrate_swap+270&gt;:  pop    %r12</span><br><span class="line">&lt;migrate_swap+272&gt;:  pop    %r13</span><br><span class="line">&lt;migrate_swap+274&gt;:  pop    %r14</span><br><span class="line">&lt;migrate_swap+276&gt;:  ret</span><br></pre></td></tr></table></figure></li>
</ul>
<p>The <code>add</code> instruction corresponds to the <code>sub</code> instruction that adds 0x18 bytes for stack. Then <code>pop</code> instructions corresponds to all <code>push</code> of the entrance. <code>%eax</code> is used to pass return value. Last <code>ret</code> instruction pop up the return address and then returns to the caller.</p>
<ul>
<li>Call a function<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;migrate_swap+140&gt;:  mov    %r12d,%edi</span><br><span class="line">&lt;migrate_swap+143&gt;:  mov    %ebp,%esi</span><br><span class="line">&lt;migrate_swap+145&gt;:  mov    %rsp,%rcx</span><br><span class="line">&lt;migrate_swap+148&gt;:  mov    $0xffffffff830ba690,%rdx</span><br><span class="line">&lt;migrate_swap+155&gt;:  call   0xffffffff8313d9f0 &lt;stop_two_cpus&gt;</span><br></pre></td></tr></table></figure>
As we mentioned in the  <a href="#Convention">Calling Conventions</a> section, <code>%rdi</code> for the 1st argument, <code>%rsi</code> for the 2nd argument, <code>%rdx</code> for the 3rd argument and <code>%rcx</code> for the 4th argument. Here <code>%edi</code> and <code>%esi</code> are for passing 32-bit arguments. Then <code>call</code> instruction jumps to <code>stop_two_cpus()</code> and it will read these arguments against calling conventions.</li>
</ul>
<p>The prototype of stop_two_cpus():</p>
<pre><code>int stop_two_cpus(unsigned int cpu1, unsigned int cpu2, cpu_stop_fn_t fn, void *arg);
</code></pre>
<ul>
<li>Read&#x2F;Write data from stack<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;migrate_swap+30&gt;:   mov    %rdi,(%rsp)</span><br><span class="line">&lt;migrate_swap+34&gt;:   mov    %rsi,0x8(%rsp)</span><br><span class="line">&lt;migrate_swap+39&gt;:   mov    %ecx,0x10(%rsp)</span><br><span class="line">&lt;migrate_swap+43&gt;:   mov    %edx,0x14(%rsp)</span><br><span class="line">...</span><br><span class="line">&lt;migrate_swap+249&gt;:  mov    0x10(%rsp),%esi</span><br><span class="line">&lt;migrate_swap+253&gt;:  mov    0x14(%rsp),%edi</span><br></pre></td></tr></table></figure></li>
</ul>
<p>As we can see, Reading and writing data from stack, the value of <code>%rsp</code> is used as the base address of memory, then add an offset to it.  If a binary is built with frame pointer, the <code>%rbp</code> can be used as base to access stack space.</p>
<p>Notice that the part of stack space is not only used to save arguments passed from the caller, sometimes it is also used for temporary result rather than local variables. </p>
<h3 id="3-Understand-the-data-of-stack-by-assembly"><a href="#3-Understand-the-data-of-stack-by-assembly" class="headerlink" title="3 Understand the data of stack by assembly "></a>3 Understand the data of stack by assembly <a id="Stack"></a></h3><h4 id="3-1-Understand-the-data-layout-of-stack"><a href="#3-1-Understand-the-data-layout-of-stack" class="headerlink" title="3.1 Understand  the data layout of stack  "></a>3.1 Understand  the data layout of stack  <a id="StackLayout"></a></h4><p>To understand all hex data in a function frame of a stack, basically, we need to understand all stack operations of a function in terms of assembly, and match the code and assembly to understand how data gets passed right before a panic triggered. First of all, let’s start with the diagram below.</p>
<h4 id="3-2-A-layout-of-stack-generally-looks-like"><a href="#3-2-A-layout-of-stack-generally-looks-like" class="headerlink" title="3.2 A layout of stack generally looks like "></a>3.2 A layout of stack generally looks like <a id="StackImage"></a></h4><p><img src="https://github.com/xwsong/xwsong.github.io/blob/main/image/stack_layout.png?raw=true" alt="image" title="StackLayout"><br>Notice that only “return address” must have, the rest of stack data are optional. It depends on the implementation or size of a function or how the compiler optimizes the function. You need to analyze the assembly of the function and frame data to understand what the stack data consists of, which will be explained below.</p>
<p>If build the binary with gcc “-fomit-frame-pointer” option, then %rbp can be use a temporary register rather than the frame pointer.</p>
<h4 id="3-3-One-whole-data-layout-of-a-frame"><a href="#3-3-One-whole-data-layout-of-a-frame" class="headerlink" title="3.3 One whole data layout of a frame "></a>3.3 One whole data layout of a frame <a id="FrameData"></a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#14 [ffffada72f79bcc8] migrate_swap at ffffffff830bad90</span><br><span class="line">    ffffada72f79bcd0: ffff8ddbf3590ec0 ffff8deaf1fe5440</span><br><span class="line">    ffffada72f79bce0: 0000002a00000010 ffff8ddbf3590ec0</span><br><span class="line">    ffffada72f79bcf0: ffff8e016b023200 0000000000000015</span><br><span class="line">    ffffada72f79bd00: ffffada72f79bd70 0000000000000000</span><br><span class="line">    ffffada72f79bd10: ffffffff830c8e8c</span><br><span class="line">#15 [ffffada72f79bd10] task_numa_fault at ffffffff830c8e8c</span><br></pre></td></tr></table></figure>
<p>There are 9*8 bytes allocated here from 0xffffada72f79bcd0 to ffffada72f79bd10. I will explain the detail in the section below.</p>
<h4 id="3-4-Understand-the-layout-over-assembly"><a href="#3-4-Understand-the-layout-over-assembly" class="headerlink" title="3.4 Understand the layout over assembly "></a>3.4 Understand the layout over assembly <a id="StackAssembly"></a></h4><p>Construct stack space:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;migrate_swap+5&gt;:    push   %r14</span><br><span class="line">&lt;migrate_swap+7&gt;:    mov    %rsi,%r14</span><br><span class="line">&lt;migrate_swap+10&gt;:   push   %r13</span><br><span class="line">&lt;migrate_swap+12&gt;:   mov    %rdi,%r13</span><br><span class="line">&lt;migrate_swap+15&gt;:   push   %r12</span><br><span class="line">&lt;migrate_swap+17&gt;:   mov    %edx,%r12d</span><br><span class="line">&lt;migrate_swap+20&gt;:   push   %rbp</span><br><span class="line">&lt;migrate_swap+21&gt;:   mov    %ecx,%ebp</span><br><span class="line">&lt;migrate_swap+23&gt;:   push   %rbx</span><br><span class="line">&lt;migrate_swap+24&gt;:   sub    $0x18,%rsp</span><br></pre></td></tr></table></figure>
<p>The frame consists of 8 bytes, there are return address, which takes 8 bytes, 5 <code>push</code> instructions, which take 5*8 &#x3D; 40 bytes, and extra 40 bytes(0x18) by <code>sub</code> instruction. So the total amount is 8 + 40 +40 &#x3D; 88 bytes, which is equal to the amount of bytes of frame #14.</p>
<p>Then the return address is stored in 0xffffada72f79bd10. The prior value of  <code>%r14</code> is stored in 0xffffada72f79bd08, the prior value of <code>%r13</code> is stored in 0xffffada72f79bd00, the prior value of <code>%r12</code> is stored in 0xffffada72f79bd08, the prior value of <code>%rbp</code> is stored in 0xffffada72f79bcf0, the prior value of %rbx is stored in 0xffffada72f79bce8.</p>
<p>To understand the data from 0xffffada72f79bcd0 to 0xffffada72f79bce0, we need to check the operations of <code>%rsp</code> in assembly level of migrate_swap(). In this function, there are 4 write operations,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;migrate_swap+30&gt;:   mov    %rdi,(%rsp)</span><br><span class="line">&lt;migrate_swap+34&gt;:   mov    %rsi,0x8(%rsp)</span><br><span class="line">&lt;migrate_swap+39&gt;:   mov    %ecx,0x10(%rsp)</span><br><span class="line">&lt;migrate_swap+43&gt;:   mov    %edx,0x14(%rsp)</span><br></pre></td></tr></table></figure>
<p>As we can see,  the first 8 bytes is used to store the value of <code>%rdi</code> in 0xffffada72f79bcd0, which is the first argument passed by caller. The second 8 bytes is used to store the value of <code>%rsi</code> which is the second argument. Then 4 bytes is for  the value of <code>%ecx</code> in 0xffffada72f79bce0, the rest is for <code>%edx</code> in 0xffffada72f79bce4. So then we’ve known every single byte in this frame and the whole view looks like:</p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Data</th>
<th>Meaning</th>
</tr>
</thead>
<tbody><tr>
<td>ffffada72f79bcd0</td>
<td>ffff8ddbf3590ec0</td>
<td>The 1st argument from caller</td>
</tr>
<tr>
<td>ffffada72f79bcd8</td>
<td>ffff8deaf1fe5440</td>
<td>The 2nd argument from caller</td>
</tr>
<tr>
<td>ffffada72f79bce0</td>
<td>00000010</td>
<td>The 4th argument from caller</td>
</tr>
<tr>
<td>ffffada72f79bce4</td>
<td>0000002a</td>
<td>the 3rd argument from caller</td>
</tr>
<tr>
<td>ffffada72f79bce8</td>
<td>ffff8ddbf3590ec0</td>
<td>The prior value of %rbx</td>
</tr>
<tr>
<td>ffffada72f79bcf0</td>
<td>ffff8e016b023200</td>
<td>The prior value of %rbp</td>
</tr>
<tr>
<td>ffffada72f79bcf8</td>
<td>0000000000000015</td>
<td>The prior value of %r12</td>
</tr>
<tr>
<td>ffffada72f79bd00</td>
<td>ffffada72f79bd70</td>
<td>The prior value of %r13</td>
</tr>
<tr>
<td>ffffada72f79bd08</td>
<td>0000000000000000</td>
<td>The prior value of %r14</td>
</tr>
<tr>
<td>ffffada72f79bd10</td>
<td>ffffffff830c8e8c</td>
<td>Return address of caller</td>
</tr>
</tbody></table>
<p>The relevant C code looks like:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">migrate_swap</span><span class="params">(<span class="keyword">struct</span> task_struct *cur, <span class="keyword">struct</span> task_struct *p,</span></span><br><span class="line"><span class="params">                <span class="type">int</span> target_cpu, <span class="type">int</span> curr_cpu)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">migration_swap_arg</span> <span class="title">arg</span>;</span></span><br><span class="line">        <span class="type">int</span> ret = -EINVAL;</span><br><span class="line"></span><br><span class="line">        arg = (<span class="keyword">struct</span> migration_swap_arg)&#123;</span><br><span class="line">                .src_task = cur, <span class="comment">/* The value of %rdi, 1st argument */</span></span><br><span class="line">                .src_cpu = curr_cpu,<span class="comment">/* The value of %edx, the 3rd argument */</span></span><br><span class="line">                .dst_task = p, <span class="comment">/* The value of %rsi, the 2nd argument */</span></span><br><span class="line">                .dst_cpu = target_cpu, <span class="comment">/* the value of %ecx, the 4th argument */</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arg.src_cpu == arg.dst_cpu)</span><br><span class="line">                <span class="keyword">goto</span> out;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The 4 <code>mov</code> instructions is to construct the local <code>arg</code>instance. Notice that some stack space is not always store local variable. Here the variable <code>ret</code> actually is not store to anywhere of memory, the return value is moved to <code>%rax</code> directly by the assembly below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;migrate_swap+263&gt;:  mov    $0xffffffea,%eax</span><br></pre></td></tr></table></figure>
<h4 id="3-5-The-purpose-of-understanding-stack-layout"><a href="#3-5-The-purpose-of-understanding-stack-layout" class="headerlink" title="3.5 The purpose of understanding stack layout "></a>3.5 The purpose of understanding stack layout <a id="Purpose"></a></h4><p>To learn how the dataflow is in a calltrace or where the data starts getting corrupted, the stack data commonly help a lot with where the problem is from.</p>
<h3 id="4-Determine-what-the-issue-is"><a href="#4-Determine-what-the-issue-is" class="headerlink" title="4 Determine what the issue is "></a>4 Determine what the issue is <a id="Determine"></a></h3><p>After analyzing a scenario in assembly level, we can understand more clear with the issue, then we might have some conclusions  as the description below like what the issue is.</p>
<h4 id="4-1-Understand-trap-instruction"><a href="#4-1-Understand-trap-instruction" class="headerlink" title="4.1 Understand  trap instruction "></a>4.1 Understand  trap instruction <a id="SoftwareBug"></a></h4><p>Generally, a software bug is easily to be triggered by accessing an illegal address of memory. For example, there is a structure pointer stored in <code>%rax</code>, then reading a member of the structure looks like:</p>
<pre><code>mov 0x10(%rax), %rbx
</code></pre>
<p>while for a NULL pointer dereference, <code>%rax</code> would have a value 0x00000000, which can trigger a panic with address  0x00000010. Here we need to find out where the NULL value of <code>%rax</code> is from or how the pointer is passed here, the pointer might be from a local variable, a pointer from function argument or from a return value of another function, etc. So we need to know what data is getting corrupted or released.  The issue probably is a UFA(Use After Free), Overwritten.</p>
<p>Sometimes, an unmeaningful address that looks not for user or kernel space is called non-canonical address, it might be the relevant page gets overwritten or  access a uninitialized pointer.</p>
<h4 id="4-2-Not-A-Software-Bug"><a href="#4-2-Not-A-Software-Bug" class="headerlink" title="4.2 Not A Software Bug "></a>4.2 Not A Software Bug <a id="Non-SoftwareBug"></a></h4><p>If the trap instruction is not accessing a memory address but the kernel reports a memory issue, generally a page fault generated, be careful, the issue might be from hardware or microcode bug or hypervisor rather than software.</p>
<p>You can run memtest86+ to confirm if there is something wrong with hardware or not.</p>
<h4 id="4-3-A-Deadlock"><a href="#4-3-A-Deadlock" class="headerlink" title="4.3 A Deadlock "></a>4.3 A Deadlock <a id="Deadlock"></a></h4><p>For a deadlock issue, you need to check why the lock request doesn’t get responded, which context is owning the requested lock and why that context has held the lock so long, generally, another process holding to the request lock on another cpu but also get blocked by something, and vise versa. A classic pattern is ABBA deadlock.</p>
<p>Mutual waiting resources, in spinlock critical section, that would be a hard lockup, because spinlock hold is under preemption and interrupt disabled. If a cpu has disabled interrupts over 10 s, kernel would report a hard lockup.</p>
<p>If an IO resource gets blocked, it would be a ‘D’ state(UNINTERRUPTABLE) issue with some processes. If a process in ‘D’ has been over 120s, then it might be an IO issue some where.</p>
<p>If there is a loop with spin_lock&#x2F;spin_unlock pair inside of it, but the loop can’t be broken because of the break condition has not gotten satisfied over 20s, it would be a soft lockup.</p>
<h3 id="5-References"><a href="#5-References" class="headerlink" title="5 References "></a>5 References <a id="Reference"></a></h3><p>[1]<a target="_blank" rel="noopener" href="http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order">http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&amp;text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order</a>.<br>[2]<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/TEST_(x86_instruction)">https://en.wikipedia.org/wiki/TEST_(x86_instruction)</a><br>[3]<a target="_blank" rel="noopener" href="https://c9x.me/x86/html/file_module_x86_id_35.html">https://c9x.me/x86/html/file_module_x86_id_35.html</a><br>[4]<a target="_blank" rel="noopener" href="https://gitlab.com/x86-psABIs/x86-64-ABI/-/jobs/artifacts/master/raw/x86-64-ABI/abi.pdf?job=build">https://gitlab.com/x86-psABIs/x86-64-ABI/-/jobs/artifacts/master/raw/x86-64-ABI/abi.pdf?job=build</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/10/kernel/kernel_panic_types/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Bruce Song">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blogs For Linux Kernel">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/10/kernel/kernel_panic_types/" class="post-title-link" itemprop="url">About kernel panic you need to know</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-10 00:00:00" itemprop="dateCreated datePublished" datetime="2024-10-10T00:00:00+08:00">2024-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-12-10 15:34:11" itemprop="dateModified" datetime="2024-12-10T15:34:11+08:00">2024-12-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This arctile is to generic types of kernel panic, describe the princeples and what can trigger a specific type of kernel panic.</p>
<h1 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h1><ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#type_panic">The Types Of Kernel Panic</a><ol>
<li><a href="#NULL_pointer_dereference">NULL pointer dereference</a></li>
<li><a href="#unable_pf">Unable to handle page fault</a></li>
<li><a href="#hard&softlockup">Hard&#x2F;Soft Lockup</a></li>
<li><a href="#task_hang">Task Hang</a></li>
<li><a href="#bug_macro">BUG&#x2F;BUG_ON</a></li>
<li><a href="#stack_overflow">Kernel Stack Overflow</a></li>
<li><a href="#rcu_stall">RCU stall</a></li>
<li><a href="#double_fault">Double Fault</a></li>
</ol>
</li>
<li><a href="#ns_knowledge">Necessary Knowledge</a> </li>
<li><a href="#reference">References</a></li>
</ol>
<h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1 Introduction "></a>1 Introduction <a name="introduction"></a></h2><h3 id="What-is-kernel-panic-and-why"><a href="#What-is-kernel-panic-and-why" class="headerlink" title="What is kernel panic and why?"></a>What is kernel panic and why?</h3><p>A kernel panic is a safety measure taken by an operating system’s kernel upon detecting an internal fatal error in which either it is unable to safely recover or continuing to run the system would have a higher risk of major data loss. The term is largely specific to Unix and Unix-like systems. The equivalent on Microsoft Windows operating systems is a stop error, often called a “blue screen of death”. <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel_panic">[1]</a></p>
<h2 id="2-The-Types-Of-Kernel-Panic"><a href="#2-The-Types-Of-Kernel-Panic" class="headerlink" title="2 The Types Of Kernel Panic"></a>2 The Types Of Kernel Panic<a name="type_panic"></a></h2><h3 id="2-1-NULL-pointer-dereference"><a href="#2-1-NULL-pointer-dereference" class="headerlink" title="2.1 NULL pointer dereference "></a>2.1 NULL pointer dereference <a name="NULL_pointer_dereference"></a></h3><p>This kind of panic info implies the kernel was using a NULL pointer to access memory.</p>
<p>A real example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[998287.514381] BUG: unable to handle kernel NULL pointer dereference at 0000000000000004</span><br><span class="line">[998287.514429] IP: set_root+0x47/0xc0</span><br><span class="line">[998287.514444] PGD 0 P4D 0</span><br><span class="line">[998287.514459] Oops: 0000 [#1] SMP NOPTI</span><br><span class="line">[998287.514475] CPU: 4 PID: 6571 Comm: stat Not tainted 4.12.14-122.231-default #1 SLE12-SP5</span><br><span class="line">[998287.514539] task: ffffa0aad66b0bc0 task.stack: ffffb8209dd40000</span><br><span class="line">[998287.514560] RIP: 0010:set_root+0x47/0xc0</span><br><span class="line">[998287.514575] RSP: 0018:ffffb8209dd43c88 EFLAGS: 00010246</span><br><span class="line">[998287.514593] RAX: 0000000000000000 RBX: ffffb8209dd43d40 RCX:0000000000000000</span><br><span class="line">[998287.514617] RDX: 0000000000000000 RSI: 0000000000000040 RDI:ffffb8209dd43d40</span><br><span class="line">[998287.514641] RBP: ffffb8209dd43ca0 R08: 0000000000000000 R09:0000000000000f8c</span><br><span class="line">[998287.514665] R10: 0000000000000058 R11: 0000000000000058 R12:ffffa0b99387cf00</span><br><span class="line">[998287.514688] R13: ffffb8209dd43e58 R14: 0000000000000041 R15:00000000000007ff</span><br><span class="line">[998287.514712] FS: 00007fe0c088d700(0000) GS:ffffa0b9b2d00000(0000) knlGS:0000000000000000</span><br><span class="line">[998287.514738] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[998287.514757] CR2: 0000000000000004 CR3: 0000000fdc29e003 CR4:00000000007606e0</span><br><span class="line">[998287.514814] DR0: 0000000000000000 DR1: 0000000000000000 DR2:0000000000000000</span><br><span class="line">[998287.514839] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7:0000000000000400</span><br><span class="line">[998287.514862] PKRU: 55555554</span><br><span class="line">[998287.514873] Call Trace:</span><br><span class="line">[998287.514887] path_init+0x1d6/0x330</span><br><span class="line">[998287.514900] path_lookupat+0x22/0x210</span><br><span class="line">[998287.514936] ? _nfs4_proc_getattr+0xbe/0xd0 [nfsv4]</span><br><span class="line">[998287.514955] filename_lookup+0x9c/0x150</span><br><span class="line">[998287.515572] ? __nfs_revalidate_inode+0x10c/0x360 [nfs]</span><br><span class="line">[998287.516078] ? path_get+0x11/0x30</span><br><span class="line">[998287.516587] ? __audit_getname+0x97/0xb0</span><br><span class="line">[998287.517095] ? getname_flags+0xf7/0x1f0</span><br><span class="line">[998287.517589] vfs_statx+0x64/0xc0</span><br><span class="line">[998287.518077] SYSC_newstat+0x26/0x50</span><br><span class="line">[998287.518566] ? syscall_trace_enter+0x1b4/0x2a0</span><br><span class="line">[998287.519043] ? __audit_syscall_exit+0x1fa/0x2b0</span><br><span class="line">[998287.519505] do_syscall_64+0x74/0x160</span><br><span class="line">[998287.519974] entry_SYSCALL_64_after_hwframe+0x7d/0xe7</span><br></pre></td></tr></table></figure>

<p>The first question is why the fault address is 0000000000000004. Generally, the value is an offset of a structure instance, so the address of the structure instance is NULL, which is 0000000000000000. 4 is the offset value of one of the members. So, when meeting a panic like this the first thing we should do is to disassemble the code of where IP instruction is in, here is set_root, and find out which pointer is NULL in c code level. The possible causes are</p>
<ol>
<li>A pointer is manually assigned to NULL by some where, which is definitely incorrect with the relevant code logic.</li>
<li>A pointer is assigned to NULL as expected. But some code blocks still use the pointer incorrectly, also known as UAF(use after free).</li>
<li>Another situation is quite tricky. It is kind of similar to 2). But in the fault line, the author would expect the pointer should be invalid, actually not. This kind of error is because the value of pointer isn’t consistent with the value of the pointer in cache of CPU, which means the relevant code logic looks correct, while CPU doesn’t synchronize memory data correctly, then a NULL pointer dereference would be triggered.</li>
</ol>
<h3 id="2-2-Unable-to-handle-page-fault"><a href="#2-2-Unable-to-handle-page-fault" class="headerlink" title="2.2 Unable to handle page fault "></a>2.2 Unable to handle page fault <a id="unable_pf"></a></h3><p>This kind of panic is similar to the NULL pointer one in terms of data corrupted. The difference is that the fault address of NULL pointers is less than one page size, while the address of page fault one is greater or equal than one page size.</p>
<p>A real example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[4492219.834650] BUG: unable to handle kernel paging request at ffff8e8d3031d710</span><br><span class="line">[4492219.834697] IP: __audit_inode_child+0x12a/0x340</span><br><span class="line">[4492219.834717] PGD 3f62a7067 P4D 3f62a7067 PUD ff04a0063 PMD fda91c063 PTE 1469d3f9918d6133</span><br><span class="line">[4492219.834751] Oops: 0009 [#1] SMP NOPTI</span><br><span class="line">[4492219.834769] CPU: 23 PID: 52391 Comm: cvd Not tainted 4.12.14-122.194-default #1 SLE12-SP5</span><br><span class="line">[4492219.834839] task: ffff8e8fabd8cb80 task.stack: ffffb83e13228000</span><br><span class="line">[4492219.834863] RIP: 0010:__audit_inode_child+0x12a/0x340</span><br><span class="line">[4492219.834883] RSP: 0018:ffffb83e1322b850 EFLAGS: 00010297</span><br><span class="line">[4492219.834905] RAX: 0000000000000000 RBX: ffff8e8e5baf0e48 RCX: ffff8e9be8eb8100</span><br><span class="line">[4492219.834932] RDX: 0000000000000001 RSI: ffff8e8f7d6bc240 RDI: ffff8e8e5baf0c00</span><br><span class="line">[4492219.834958] RBP: ffff8e8f7d6bc278 R08: 0000000000000000 R09: 0000000000000001</span><br><span class="line">[4492219.834985] R10: 0000000000000000 R11: 000000000000000f R12: ffff8e9be8eb8100</span><br><span class="line">[4492219.835011] R13: ffffffffa51cdb40 R14: 0000000000000000 R15: ffff8e8d3031d700</span><br><span class="line">[4492219.835038] FS: 00007f852a8cf700(0000) GS:ffff8e9bf31c0000(0000) knlGS:0000000000000000</span><br><span class="line">[4492219.835068] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[4492219.835090] CR2: ffff8e8d3031d710 CR3: 0000000fdc960001 CR4: 00000000007606e0</span><br><span class="line">[4492219.835157] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000</span><br><span class="line">[4492219.835186] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400</span><br><span class="line">[4492219.835213] PKRU: 55555554</span><br><span class="line">[4492219.835225] Call Trace:</span><br><span class="line">[4492219.835244] debugfs_create_dir+0xe0/0x100</span><br><span class="line">[4492219.835277] rpc_clnt_debugfs_register+0x7a/0x130 [sunrpc]</span><br><span class="line">[4492219.835307] rpc_client_register+0x31/0x170 [sunrpc]</span><br><span class="line">[4492219.835335] rpc_new_client+0x1e1/0x2d0 [sunrpc]</span><br><span class="line">[4492219.835361] rpc_create_xprt+0x55/0x220 [sunrpc]</span><br><span class="line">[4492219.835381] ? __debugfs_create_file+0xca/0x110</span><br><span class="line">[4492219.835408] ? rpc_xprt_debugfs_register+0xa6/0xe0 [sunrpc]</span><br><span class="line">[4492219.836048] rpc_create+0x17b/0x270 [sunrpc]</span><br><span class="line">[4492219.836666] ? lock_timer_base+0x67/0x90</span><br><span class="line">[4492219.837265] ? internal_add_timer+0x1a/0x70</span><br><span class="line">[4492219.837858] rpcb_create+0x83/0xa0 [sunrpc]</span><br><span class="line">[4492219.838465] rpcb_getport_async+0x1af/0x4f0 [sunrpc]</span><br><span class="line">[4492219.839049] ? __wait_on_bit+0x74/0x90</span><br><span class="line">[4492219.839617] ? __rpc_wait_for_completion_task+0x30/0x30 [sunrpc]</span><br><span class="line">[4492219.840200] ? out_of_line_wait_on_bit+0x6e/0x80</span><br><span class="line">[4492219.840773] ? rpc_setup_pipedir_sb+0xf0/0xf0 [sunrpc]</span><br><span class="line">[4492219.841331] ? rpc_setup_pipedir_sb+0xf0/0xf0 [sunrpc]</span><br><span class="line">[4492219.841879] __rpc_execute+0xdd/0x460 [sunrpc]</span><br><span class="line">[4492219.842408] rpc_run_task+0xd4/0x120 [sunrpc]</span><br><span class="line">[4492219.842945] rpc_call_sync+0x3f/0x80 [sunrpc]</span><br></pre></td></tr></table></figure>

<p>When this situation happens, it is probably</p>
<ol>
<li>the address is an invalid pointer which is similar to situation 1.</li>
<li>the page table(pt) of the current process is incorrect. The pt might have gotten corrupted. Then you need to check the memory address that the page table is placed in, find out if some code overwrote the relevant page or memory.</li>
</ol>
<h3 id="2-3-Hard-Soft-Lockup"><a href="#2-3-Hard-Soft-Lockup" class="headerlink" title="2.3 Hard&#x2F;Soft Lockup"></a>2.3 Hard&#x2F;Soft Lockup<a id="hard&softlockup"></a></h3><h4 id="What-is-hard-lockup"><a href="#What-is-hard-lockup" class="headerlink" title="What is hard lockup?"></a>What is hard lockup?</h4><p>A ‘hardlockup’ is defined as a bug that causes the CPU to loop in kernel mode for more than 10 seconds without letting other interrupts have a chance to run. <a target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/lockup-watchdogs.html">[2]</a></p>
<p>1)You can stop the panic by unsetting hardlockup_panic with sysctl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w kernel.hardlockup_panic=1</span><br></pre></td></tr></table></figure>
<p>2)Or append nmi_watchdog&#x3D;0 in kernel command line<br>3)Or unset during compilation with</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_BOOTPARAM_HARDLOCKUP_PANIC=n</span><br></pre></td></tr></table></figure>

<p>From my experience, this kind of error is generally because of hardware issues as it’s impossible to disable interrupt in code level for so long time, I’ve never seen a software bug to trigger this error. You can check the bit9 of EFLAGS on the x86 platform if the interrupt is disabled or not when hitting a panic like this. The principle of it is because the value of hrtimer_interrupts doesn’t get updated as no interrupts can be routed to the kernel.</p>
<p>However, I’m not 100% sure if there is a software issue triggering an error like this. You need to analyze the panic info and kernel code accordingly.</p>
<h4 id="What-is-soft-lockup"><a href="#What-is-soft-lockup" class="headerlink" title="What is soft lockup?"></a>What is soft lockup?</h4><p>A ‘soft lockup’ is defined as a bug that causes the kernel to loop in kernel mode for more than 20 seconds, without giving other tasks a chance to run， which implies no scheduled events happened on a CPU. <a target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/lockup-watchdogs.html">[2]</a></p>
<p>From my experience, most soft lockups are triggered by holding busy locks for more than 20s, the most common type of it is spin lock. So just check the code of the function on the top of the call trace, and find out if there is a spin lock is hold for a long time.</p>
<p>I also saw another way says there are too many interrupts that can block schedule events. I’ve never seen such a case so far.</p>
<p>If you don’t want to panic your system when meeting soft lockup, you can disable the behavior with the following ways:</p>
<ol>
<li>disable panic at runtime over<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w kernel.softlockup_panic=0</span><br></pre></td></tr></table></figure></li>
<li>add softlockup_panic&#x3D;0 to kernel command line</li>
<li>disable panic during compilation of kernel over setting<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC=n</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-4-Task-hang"><a href="#2-4-Task-hang" class="headerlink" title="2.4 Task hang"></a>2.4 Task hang<a id="task_hang"></a></h3><p>A task hang implies a task&#x2F;process hasn’t been scheduled for a long time. The time value can be set with kernel.hung_task_timeout_secs.</p>
<p>Generally, the reason why a task&#x2F;process doesn’t get scheduled is because it waited on a list with TASK_UNINTERRUPTIBLE state for a long time. When you see the state of it over ps command like<br>“ps -eo pid,stat”</p>
<p>There would be a ‘D’, maybe also with other state signs. In this scenario, we can set the following kernel options to trigger a kernel panic and get a kernel core dump used to analyze more about it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl -a kernel.hung_task_panic=1</span><br><span class="line">sysctl -a kernel.hung_task_timeout_secs=120</span><br></pre></td></tr></table></figure>

<p>What we need to do with the kernel core dump is to check the wait list and the data inside of the relevant lock that is waited, and find out the owner of the lock, then see the stack trace of the owner and understand what it was doing at that moment.</p>
<h3 id="2-5-BUG-BUG-ON"><a href="#2-5-BUG-BUG-ON" class="headerlink" title="2.5 BUG&#x2F;BUG_ON"></a>2.5 BUG&#x2F;BUG_ON<a id="bug_macro"></a></h3><p>The BUG macro is to print some useful info first then, call panic() to crash kernel. The BUG_ON is to check a condition first, if it’s true then call BUG() macro. When hitting this situation, there would be a line with prefix “kernel  BUG at  …”, which is used to show you where the bug is from.</p>
<p>A real example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[ 2936.363067] kernel BUG at /home/rishi/doc_linux_kernel_workbook/doc/code/05_bug_reporting/01_bugon/mybugondriver.c:45!</span><br><span class="line">[ 2936.363101] invalid opcode: 0000 [#1] SMP</span><br><span class="line">[ 2936.363118] Modules linked in: mybugondriver(OE) ppdev vboxvideo ttm drm_kms_helper drm snd_intel8x0 fb_sys_fops snd_ac97_codec syscopyarea ac97_bus sysfillrect snd_pcm joydev sysimgblt input_leds snd_timer snd soundcore serio_raw i2c_piix4 parport_pc vboxguest 8250_fintek parport mac_hid ib_iser rdma_cm iw_cm ib_cm ib_sa ib_mad ib_core ib_addr iscsi_tcp libiscsi_tcp libiscsi scsi_transport_iscsi autofs4 btrfs raid10 raid456 async_raid6_recov async_memcpy async_pq async_xor async_tx xor raid6_pq libcrc32c raid1 raid0 multipath linear hid_generic usbhid hid crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd ahci psmouse libahci e1000 pata_acpi fjes video</span><br><span class="line">[ 2936.363407] CPU: 0 PID: 1766 Comm: bash Tainted: G OE 4.4.0-62-generic #83-Ubuntu</span><br><span class="line">[ 2936.363429] Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006</span><br><span class="line">[ 2936.363451] task: ffff8800d8deb800 ti: ffff880035734000 task.ti: ffff880035734000</span><br><span class="line">[ 2936.363471] RIP: 0010:[&lt;ffffffffc03e618e&gt;] [&lt;ffffffffc03e618e&gt;] my_proc_write+0xae/0xc0 [mybugondriver]</span><br><span class="line">[ 2936.363501] RSP: 0018:ffff880035737e78 EFLAGS: 00010246</span><br><span class="line">[ 2936.363516] RAX: 0000000000000000 RBX: 0000000000000002 RCX: 00000000000032a5</span><br><span class="line">[ 2936.363535] RDX: 00000000000032a4 RSI: ffff88011b41a020 RDI: ffff880116801e00</span><br><span class="line">[ 2936.363553] RBP: ffff880035737e90 R08: 000000000001a020 R09: ffffffffc03e615c</span><br><span class="line">[ 2936.363572] R10: ffffea0004572b40 R11: 0000000000000239 R12: ffff880115cad950</span><br><span class="line">[ 2936.363592] R13: 0000000001189408 R14: 0000000000000002 R15: 0000000000000000</span><br><span class="line">[ 2936.363611] FS: 00007f4b6fc64700(0000) GS:ffff88011b400000(0000) knlGS:0000000000000000</span><br><span class="line">[ 2936.363633] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[ 2936.363648] CR2: 00007ffedb58b4b8 CR3: 00000000d597d000 CR4: 00000000000406f0</span><br><span class="line">[ 2936.363669] Stack:</span><br><span class="line">[ 2936.363676] ffff8800344a4a80 fffffffffffffffb ffff880035737f18 ffff880035737eb0</span><br><span class="line">[ 2936.363699] ffffffff8127bee2 ffff8800da934400 0000000001189408 ffff880035737ec0</span><br><span class="line">[ 2936.363723] ffffffff8120e168 ffff880035737f00 ffffffff8120eaf9 ffffffff810caeb1</span><br><span class="line">[ 2936.363746] Call Trace:</span><br><span class="line">[ 2936.363758] [&lt;ffffffff8127bee2&gt;] proc_reg_write+0x42/0x70</span><br><span class="line">[ 2936.363784] [&lt;ffffffff8120e168&gt;] __vfs_write+0x18/0x40</span><br><span class="line">[ 2936.363799] [&lt;ffffffff8120eaf9&gt;] vfs_write+0xa9/0x1a0</span><br><span class="line">[ 2936.364337] [&lt;ffffffff810caeb1&gt;] ? __raw_callee_save___pv_queued_spin_unlock+0x11/0x20</span><br><span class="line">[ 2936.365035] [&lt;ffffffff8120f7b5&gt;] SyS_write+0x55/0xc0</span><br><span class="line">[ 2936.365697] [&lt;ffffffff818385f2&gt;] entry_SYSCALL_64_fastpath+0x16/0x71</span><br><span class="line">[ 2936.366236] Code: f8 02 74 29 7e 20 83 f8 03 74 11 83 f8 04 75 11 48 c7 c7 e0 70 3e c0 e8 c5 6f da c0 e8 7c 1a 01 c1 48 89 d8 eb 9c 83 e8 01 75 f6 &lt;0f&gt; 0b 0f 0b 0f 1f 40 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44</span><br><span class="line">[ 2936.367912] RIP [&lt;ffffffffc03e618e&gt;] my_proc_write+0xae/0xc0 [mybugondriver]</span><br><span class="line">[ 2936.368464] RSP &lt;ffff880035737e78&gt;</span><br><span class="line">[ 2936.369000] fbcon_switch: detected unhandled fb_set_par error, error code -16</span><br><span class="line">[ 2936.370289] fbcon_switch: detected unhandled fb_set_par error, error code -16</span><br><span class="line">[ 2936.371596] ---[ end trace 064cb0dbcc2892d3 ]---</span><br></pre></td></tr></table></figure>

<p>These two macros are generally added because an unexpected fatal error is happening. In other words, when the condition is true, there must be a BUG. So this situation is easy to understand where is wrong. You should check all the spots that might make the condition true.</p>
<h3 id="2-6-Kernel-stack-overflow"><a href="#2-6-Kernel-stack-overflow" class="headerlink" title="2.6 Kernel stack overflow"></a>2.6 Kernel stack overflow<a id="stack_overflow"></a></h3><p>A kernel stack is used to perform the code of kernel space. It’s 2 pages big on x86_64 arch. Generally, 2 pages are enough for any call patch in kernel. But there are always some bugs, so sometimes a stack operation might read&#x2F;write something beyond the boundary of kernel stack. Before VMAP_STACK got merged to mainline, it’s hard to track errors like this. With VMAP_STACK, we can get the notification when reading&#x2F;writing something to much on kernel stack</p>
<p>An example from <a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/6128111">[3]</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[ 6932.427010] BUG: stack guard page was hit at 00000000182b894e (stack is 0000000031e90a73..00000000d798f80a)</span><br><span class="line">[ 6932.427390] kernel stack overflow (double-fault): 0000 [#1] SMP NOPTI</span><br><span class="line">[ 6932.427730] CPU: 20 PID: 60530 Comm: qemu-kvm Kdump: loaded Tainted: G I --------- - - 4.18.0-240.10.1.el8_3.x86_64 #1</span><br><span class="line">[ 6932.428498] Hardware name: Dell Inc. PowerEdge R740/0WXD1Y, BIOS 2.10.2 02/24/2021</span><br><span class="line">[ 6932.429040] RIP: 0010:kvm_set_irq+0x46/0x130 [kvm]</span><br><span class="line">[ 6932.429528] Code: f3 48 81 ec d0 00 00 00 65 48 8b 04 25 28 00 00 00 48 89 84 24 c8 00 00 00 31 c0 0f 1f 44 00 00 4d 8d bd 40 30 02 00 4c 89 ff &lt;e8&gt; 95 f6 85 f9 44 89 f2 4c 89 ef 48 8d 74 24 08 89 44 24 04 e8 11</span><br><span class="line">[ 6932.430675] RSP: 0018:ffffab1800debf38 EFLAGS: 00010246</span><br><span class="line">[ 6932.431246] RAX: 0000000000000000 RBX: 0000000000000001 RCX: 0000000000000000</span><br><span class="line">[ 6932.431851] RDX: 000000000000000b RSI: 0000000000000001 RDI: ffffab17d9b64040</span><br><span class="line">[ 6932.432419] RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000</span><br><span class="line">[ 6932.432825] R10: ffff8c3f31f28000 R11: 0000000000000000 R12: 0000000000000000</span><br><span class="line">[ 6932.433157] R13: ffffab17d9b41000 R14: 000000000000000b R15: ffffab17d9b64040</span><br><span class="line">[ 6932.433488] FS: 00007fcb72fcd680(0000) GS:ffff8bc2bfa80000(0000) knlGS:0000000000000000</span><br><span class="line">[ 6932.433833] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[ 6932.434173] CR2: ffffab1800debf28 CR3: 00000069fd808001 CR4: 00000000007626e0</span><br><span class="line">[ 6932.434516] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000</span><br><span class="line">[ 6932.434869] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400</span><br><span class="line">[ 6932.435213] PKRU: 55555554</span><br><span class="line">[ 6932.435556] Call Trace:</span><br><span class="line">[ 6932.435930] irqfd_resampler_ack+0x32/0x90 [kvm]</span><br><span class="line">[ 6932.436295] kvm_notify_acked_irq+0x5f/0xc0 [kvm]</span><br><span class="line">[ 6932.436652] kvm_ioapic_update_eoi_one.isra.10+0x3d/0x140 [kvm]</span><br><span class="line">[ 6932.437011] ioapic_set_irq+0x240/0x2d0 [kvm]</span><br><span class="line">[ 6932.437358] kvm_ioapic_set_irq+0x61/0x90 [kvm]</span><br><span class="line">[ 6932.437715] kvm_set_irq+0xa1/0x130 [kvm]</span><br><span class="line">[...snip...]</span><br><span class="line">[ 6932.525049] do_vfs_ioctl+0xa4/0x640</span><br><span class="line">[ 6932.525494] ksys_ioctl+0x60/0x90</span><br><span class="line">[ 6932.525888] __x64_sys_ioctl+0x16/0x20</span><br><span class="line">[ 6932.526282] do_syscall_64+0x5b/0x1a0</span><br><span class="line">[ 6932.526703] entry_SYSCALL_64_after_hwframe+0x65/0xca</span><br><span class="line">[ 6932.527099] RIP: 0033:0x7fcb6dcbd88b</span><br><span class="line">[ 6932.527493] Code: 0f 1e fa 48 8b 05 fd 95 2c 00 64 c7 00 26 00 00 00 48 c7 c0 ff ff ff ff c3 66 0f 1f 44 00 00 f3 0f 1e fa b8 10 00 00 00 0f 05 &lt;48&gt; 3d 01 f0 ff ff 73 01 c3 48 8b 0d cd 95 2c 00 f7 d8 64 89 01 48</span><br><span class="line">[ 6932.528233] RSP: 002b:00007ffc904196b8 EFLAGS: 00000246 ORIG_RAX: 0000000000000010</span><br><span class="line">[ 6932.528655] RAX: ffffffffffffffda RBX: 000055721dcba5c0 RCX: 00007fcb6dcbd88b</span><br><span class="line">[ 6932.528940] RDX: 00007ffc90419720 RSI: ffffffffc008ae67 RDI: 0000000000000017</span><br><span class="line">[ 6932.529213] RBP: 0000000000000001 R08: 000000000000000b R09: 000000000000002c</span><br><span class="line">[ 6932.529487] R10: 00007fcb6df87ba0 R11: 0000000000000246 R12: 000000000000000b</span><br><span class="line">[ 6932.529772] R13: 0000000000000001 R14: 000055721c08f770 R15: 000055721dc23854</span><br></pre></td></tr></table></figure>

<p>For this situation, we need to disassemble the last function. Here it’s kvm_set_irq(). Find out which parameter&#x2F;data is incorrect. But not all scenarios are caused by software issues. I’ve ever seen an issue that over the boundary of stack is because a “rep mov” instruction was performed once more than expected. Then a kernel stack overflow was reported. This issue turned out to be an issue from intel ucode.</p>
<h3 id="2-7-RCU-stall"><a href="#2-7-RCU-stall" class="headerlink" title="2.7 RCU stall"></a>2.7 RCU stall<a id="rcu_stall"></a></h3><p>This type of panic is quite complex. There are some reasons to cause the panic. You can reference <a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/RCU/stallwarn.txt">[4]</a> to learn more. My knowledge about rcu stall is still not enough, will update later. To generate a panic during rc stall, you can set the option below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w kernel.panic_on_rcu_stall=1</span><br></pre></td></tr></table></figure>

<h3 id="2-8-double-fault"><a href="#2-8-double-fault" class="headerlink" title="2.8 double fault"></a>2.8 double fault<a id="double_fault"></a></h3><p>Will update later.</p>
<p>Note that a panic for hard&#x2F;soft lockup and hung tasks is not necessary. It depends on how you use your OS. Generally, A high availability system needs this kind of panic. Otherwise, the panic will break downyou system. So you should enable panic for these scenarios accordingly.</p>
<h2 id="3-The-necessary-knowledge-for-understanding-a-panic-in-code-level"><a href="#3-The-necessary-knowledge-for-understanding-a-panic-in-code-level" class="headerlink" title="3 The necessary knowledge for understanding a panic in code level"></a>3 The necessary knowledge for understanding a panic in code level<a id="ns_knowledge"></a></h2><ol>
<li>Understand the principle of each panic type. Aware of why the kernel generates such a panic. Then you might get a chance to fix it.</li>
<li>Aware of call convention on the CPU archs you work on. When disassembling a function, to understand how a variable is passed and operated, you need to know how registers are used in the platform you are working on.  For example, on the x86_64 the caller uses registers to pass the first 6 arguments to the callee. Given the arguments in left-to-right order, the order of registers used is: %rdi, %rsi, %rdx, %rcx, %r8, and %r9. Any remaining arguments are passed on the stack in reverse order so that they can be popped off the stack in order<a target="_blank" rel="noopener" href="http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order.">[5]</a>.</li>
<li>Aware of stack layout. To understand disassembly better, you need to know which bytes are used to save the prior %rpb value, return address, local variables, etc.</li>
<li>You have to be familiar with the code style of kernel.</li>
<li>Learn how to use crash tool, some useful subcommands like disassemble, kmem, list, etc.</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:<a id="reference"></a></h2><p>[1] <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel_panic">https://en.wikipedia.org/wiki/Kernel_panic</a><br>[2] <a target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/lockup-watchdogs.html">https://docs.kernel.org/admin-guide/lockup-watchdogs.html</a><br>[3] <a target="_blank" rel="noopener" href="https://access.redhat.com/solutions/6128111">https://access.redhat.com/solutions/6128111</a><br>[4] <a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/RCU/stallwarn.txt">https://www.kernel.org/doc/Documentation/RCU/stallwarn.txt</a><br>[5]<a target="_blank" rel="noopener" href="http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order">http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&amp;text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order</a>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/01/01/About_me/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Bruce Song">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blogs For Linux Kernel">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/01/About_me/" class="post-title-link" itemprop="url">Welcome to my home page!</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-01 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-01T00:00:00+08:00">2020-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-12-10 13:31:31" itemprop="dateModified" datetime="2024-12-10T13:31:31+08:00">2024-12-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Who-am-I"><a href="#Who-am-I" class="headerlink" title="Who am I?"></a>Who am I?</h2><p>I am a linux hacker who has been working on linux over 10 years. I still have massive passion with linux.</p>
<h2 id="What’s-the-purpose"><a href="#What’s-the-purpose" class="headerlink" title="What’s the purpose?"></a>What’s the purpose?</h2><p>This blog site is used to note linux related content that I’m familiar with like linux kernel, some of common linux tools, c language, shell, etc. I try to share some of my experience about how to do some specific things that is able to improve my work efficiency on linux.</p>
<h2 id="How-to-contact-me"><a href="#How-to-contact-me" class="headerlink" title="How to contact me?"></a>How to contact me?</h2><p>Please email me with <a href="mailto:&#115;&#x78;&#x77;&#98;&#114;&#x75;&#99;&#101;&#64;&#103;&#109;&#97;&#x69;&#x6c;&#46;&#99;&#111;&#109;">&#115;&#x78;&#x77;&#98;&#114;&#x75;&#99;&#101;&#64;&#103;&#109;&#97;&#x69;&#x6c;&#46;&#99;&#111;&#109;</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Bruce Song</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bruce Song</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
