<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-THGBSNJZKP"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-THGBSNJZKP');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Keep Team">
    
    <title>
        
            About kernel panic you need to know |
        
        XW&#39;s blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"en"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"XW's blog","author":"Keep Team","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null,"icon":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":false,"preload":false},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":null,"reaction":false,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"google_analytics":{"tracking_id":"G-THGBSNJZKP","only_pageview":false},"root":"","source_data":{},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               XW&#39;s blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        About kernel panic you need to know
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Keep Team</span>
                                
                                    <span class="author-badge">Lv1</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-10-10 00:00:00</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                    <span class="datetime" data-updated="Tue Dec 10 2024 15:34:11 GMT+0800">2024-12-10 15:34:11</span>
                </span>
            
        

        

        

        
        
        
        
    </div>

    
</div>

                                    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="meta-info-item post-pv" style="display: inline-block;"><i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv">2065</span></span>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <p>This arctile is to generic types of kernel panic, describe the princeples and what can trigger a specific type of kernel panic.</p>
<h1 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h1><ol>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#type_panic">The Types Of Kernel Panic</a><ol>
<li><a href="#NULL_pointer_dereference">NULL pointer dereference</a></li>
<li><a href="#unable_pf">Unable to handle page fault</a></li>
<li><a href="#hard&softlockup">Hard&#x2F;Soft Lockup</a></li>
<li><a href="#task_hang">Task Hang</a></li>
<li><a href="#bug_macro">BUG&#x2F;BUG_ON</a></li>
<li><a href="#stack_overflow">Kernel Stack Overflow</a></li>
<li><a href="#rcu_stall">RCU stall</a></li>
<li><a href="#double_fault">Double Fault</a></li>
</ol>
</li>
<li><a href="#ns_knowledge">Necessary Knowledge</a> </li>
<li><a href="#reference">References</a></li>
</ol>
<h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1 Introduction "></a>1 Introduction <a name="introduction"></a></h2><h3 id="What-is-kernel-panic-and-why"><a href="#What-is-kernel-panic-and-why" class="headerlink" title="What is kernel panic and why?"></a>What is kernel panic and why?</h3><p>A kernel panic is a safety measure taken by an operating system’s kernel upon detecting an internal fatal error in which either it is unable to safely recover or continuing to run the system would have a higher risk of major data loss. The term is largely specific to Unix and Unix-like systems. The equivalent on Microsoft Windows operating systems is a stop error, often called a “blue screen of death”. <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel_panic" >[1]<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="2-The-Types-Of-Kernel-Panic"><a href="#2-The-Types-Of-Kernel-Panic" class="headerlink" title="2 The Types Of Kernel Panic"></a>2 The Types Of Kernel Panic<a name="type_panic"></a></h2><h3 id="2-1-NULL-pointer-dereference"><a href="#2-1-NULL-pointer-dereference" class="headerlink" title="2.1 NULL pointer dereference "></a>2.1 NULL pointer dereference <a name="NULL_pointer_dereference"></a></h3><p>This kind of panic info implies the kernel was using a NULL pointer to access memory.</p>
<p>A real example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[998287.514381] BUG: unable to handle kernel NULL pointer dereference at 0000000000000004</span><br><span class="line">[998287.514429] IP: set_root+0x47/0xc0</span><br><span class="line">[998287.514444] PGD 0 P4D 0</span><br><span class="line">[998287.514459] Oops: 0000 [#1] SMP NOPTI</span><br><span class="line">[998287.514475] CPU: 4 PID: 6571 Comm: stat Not tainted 4.12.14-122.231-default #1 SLE12-SP5</span><br><span class="line">[998287.514539] task: ffffa0aad66b0bc0 task.stack: ffffb8209dd40000</span><br><span class="line">[998287.514560] RIP: 0010:set_root+0x47/0xc0</span><br><span class="line">[998287.514575] RSP: 0018:ffffb8209dd43c88 EFLAGS: 00010246</span><br><span class="line">[998287.514593] RAX: 0000000000000000 RBX: ffffb8209dd43d40 RCX:0000000000000000</span><br><span class="line">[998287.514617] RDX: 0000000000000000 RSI: 0000000000000040 RDI:ffffb8209dd43d40</span><br><span class="line">[998287.514641] RBP: ffffb8209dd43ca0 R08: 0000000000000000 R09:0000000000000f8c</span><br><span class="line">[998287.514665] R10: 0000000000000058 R11: 0000000000000058 R12:ffffa0b99387cf00</span><br><span class="line">[998287.514688] R13: ffffb8209dd43e58 R14: 0000000000000041 R15:00000000000007ff</span><br><span class="line">[998287.514712] FS: 00007fe0c088d700(0000) GS:ffffa0b9b2d00000(0000) knlGS:0000000000000000</span><br><span class="line">[998287.514738] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[998287.514757] CR2: 0000000000000004 CR3: 0000000fdc29e003 CR4:00000000007606e0</span><br><span class="line">[998287.514814] DR0: 0000000000000000 DR1: 0000000000000000 DR2:0000000000000000</span><br><span class="line">[998287.514839] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7:0000000000000400</span><br><span class="line">[998287.514862] PKRU: 55555554</span><br><span class="line">[998287.514873] Call Trace:</span><br><span class="line">[998287.514887] path_init+0x1d6/0x330</span><br><span class="line">[998287.514900] path_lookupat+0x22/0x210</span><br><span class="line">[998287.514936] ? _nfs4_proc_getattr+0xbe/0xd0 [nfsv4]</span><br><span class="line">[998287.514955] filename_lookup+0x9c/0x150</span><br><span class="line">[998287.515572] ? __nfs_revalidate_inode+0x10c/0x360 [nfs]</span><br><span class="line">[998287.516078] ? path_get+0x11/0x30</span><br><span class="line">[998287.516587] ? __audit_getname+0x97/0xb0</span><br><span class="line">[998287.517095] ? getname_flags+0xf7/0x1f0</span><br><span class="line">[998287.517589] vfs_statx+0x64/0xc0</span><br><span class="line">[998287.518077] SYSC_newstat+0x26/0x50</span><br><span class="line">[998287.518566] ? syscall_trace_enter+0x1b4/0x2a0</span><br><span class="line">[998287.519043] ? __audit_syscall_exit+0x1fa/0x2b0</span><br><span class="line">[998287.519505] do_syscall_64+0x74/0x160</span><br><span class="line">[998287.519974] entry_SYSCALL_64_after_hwframe+0x7d/0xe7</span><br></pre></td></tr></table></figure>

<p>The first question is why the fault address is 0000000000000004. Generally, the value is an offset of a structure instance, so the address of the structure instance is NULL, which is 0000000000000000. 4 is the offset value of one of the members. So, when meeting a panic like this the first thing we should do is to disassemble the code of where IP instruction is in, here is set_root, and find out which pointer is NULL in c code level. The possible causes are</p>
<ol>
<li>A pointer is manually assigned to NULL by some where, which is definitely incorrect with the relevant code logic.</li>
<li>A pointer is assigned to NULL as expected. But some code blocks still use the pointer incorrectly, also known as UAF(use after free).</li>
<li>Another situation is quite tricky. It is kind of similar to 2). But in the fault line, the author would expect the pointer should be invalid, actually not. This kind of error is because the value of pointer isn’t consistent with the value of the pointer in cache of CPU, which means the relevant code logic looks correct, while CPU doesn’t synchronize memory data correctly, then a NULL pointer dereference would be triggered.</li>
</ol>
<h3 id="2-2-Unable-to-handle-page-fault"><a href="#2-2-Unable-to-handle-page-fault" class="headerlink" title="2.2 Unable to handle page fault "></a>2.2 Unable to handle page fault <a id="unable_pf"></a></h3><p>This kind of panic is similar to the NULL pointer one in terms of data corrupted. The difference is that the fault address of NULL pointers is less than one page size, while the address of page fault one is greater or equal than one page size.</p>
<p>A real example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[4492219.834650] BUG: unable to handle kernel paging request at ffff8e8d3031d710</span><br><span class="line">[4492219.834697] IP: __audit_inode_child+0x12a/0x340</span><br><span class="line">[4492219.834717] PGD 3f62a7067 P4D 3f62a7067 PUD ff04a0063 PMD fda91c063 PTE 1469d3f9918d6133</span><br><span class="line">[4492219.834751] Oops: 0009 [#1] SMP NOPTI</span><br><span class="line">[4492219.834769] CPU: 23 PID: 52391 Comm: cvd Not tainted 4.12.14-122.194-default #1 SLE12-SP5</span><br><span class="line">[4492219.834839] task: ffff8e8fabd8cb80 task.stack: ffffb83e13228000</span><br><span class="line">[4492219.834863] RIP: 0010:__audit_inode_child+0x12a/0x340</span><br><span class="line">[4492219.834883] RSP: 0018:ffffb83e1322b850 EFLAGS: 00010297</span><br><span class="line">[4492219.834905] RAX: 0000000000000000 RBX: ffff8e8e5baf0e48 RCX: ffff8e9be8eb8100</span><br><span class="line">[4492219.834932] RDX: 0000000000000001 RSI: ffff8e8f7d6bc240 RDI: ffff8e8e5baf0c00</span><br><span class="line">[4492219.834958] RBP: ffff8e8f7d6bc278 R08: 0000000000000000 R09: 0000000000000001</span><br><span class="line">[4492219.834985] R10: 0000000000000000 R11: 000000000000000f R12: ffff8e9be8eb8100</span><br><span class="line">[4492219.835011] R13: ffffffffa51cdb40 R14: 0000000000000000 R15: ffff8e8d3031d700</span><br><span class="line">[4492219.835038] FS: 00007f852a8cf700(0000) GS:ffff8e9bf31c0000(0000) knlGS:0000000000000000</span><br><span class="line">[4492219.835068] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[4492219.835090] CR2: ffff8e8d3031d710 CR3: 0000000fdc960001 CR4: 00000000007606e0</span><br><span class="line">[4492219.835157] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000</span><br><span class="line">[4492219.835186] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400</span><br><span class="line">[4492219.835213] PKRU: 55555554</span><br><span class="line">[4492219.835225] Call Trace:</span><br><span class="line">[4492219.835244] debugfs_create_dir+0xe0/0x100</span><br><span class="line">[4492219.835277] rpc_clnt_debugfs_register+0x7a/0x130 [sunrpc]</span><br><span class="line">[4492219.835307] rpc_client_register+0x31/0x170 [sunrpc]</span><br><span class="line">[4492219.835335] rpc_new_client+0x1e1/0x2d0 [sunrpc]</span><br><span class="line">[4492219.835361] rpc_create_xprt+0x55/0x220 [sunrpc]</span><br><span class="line">[4492219.835381] ? __debugfs_create_file+0xca/0x110</span><br><span class="line">[4492219.835408] ? rpc_xprt_debugfs_register+0xa6/0xe0 [sunrpc]</span><br><span class="line">[4492219.836048] rpc_create+0x17b/0x270 [sunrpc]</span><br><span class="line">[4492219.836666] ? lock_timer_base+0x67/0x90</span><br><span class="line">[4492219.837265] ? internal_add_timer+0x1a/0x70</span><br><span class="line">[4492219.837858] rpcb_create+0x83/0xa0 [sunrpc]</span><br><span class="line">[4492219.838465] rpcb_getport_async+0x1af/0x4f0 [sunrpc]</span><br><span class="line">[4492219.839049] ? __wait_on_bit+0x74/0x90</span><br><span class="line">[4492219.839617] ? __rpc_wait_for_completion_task+0x30/0x30 [sunrpc]</span><br><span class="line">[4492219.840200] ? out_of_line_wait_on_bit+0x6e/0x80</span><br><span class="line">[4492219.840773] ? rpc_setup_pipedir_sb+0xf0/0xf0 [sunrpc]</span><br><span class="line">[4492219.841331] ? rpc_setup_pipedir_sb+0xf0/0xf0 [sunrpc]</span><br><span class="line">[4492219.841879] __rpc_execute+0xdd/0x460 [sunrpc]</span><br><span class="line">[4492219.842408] rpc_run_task+0xd4/0x120 [sunrpc]</span><br><span class="line">[4492219.842945] rpc_call_sync+0x3f/0x80 [sunrpc]</span><br></pre></td></tr></table></figure>

<p>When this situation happens, it is probably</p>
<ol>
<li>the address is an invalid pointer which is similar to situation 1.</li>
<li>the page table(pt) of the current process is incorrect. The pt might have gotten corrupted. Then you need to check the memory address that the page table is placed in, find out if some code overwrote the relevant page or memory.</li>
</ol>
<h3 id="2-3-Hard-Soft-Lockup"><a href="#2-3-Hard-Soft-Lockup" class="headerlink" title="2.3 Hard&#x2F;Soft Lockup"></a>2.3 Hard&#x2F;Soft Lockup<a id="hard&softlockup"></a></h3><h4 id="What-is-hard-lockup"><a href="#What-is-hard-lockup" class="headerlink" title="What is hard lockup?"></a>What is hard lockup?</h4><p>A ‘hardlockup’ is defined as a bug that causes the CPU to loop in kernel mode for more than 10 seconds without letting other interrupts have a chance to run. <a class="link"   target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/lockup-watchdogs.html" >[2]<i class="fas fa-external-link-alt"></i></a></p>
<p>1)You can stop the panic by unsetting hardlockup_panic with sysctl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w kernel.hardlockup_panic=1</span><br></pre></td></tr></table></figure>
<p>2)Or append nmi_watchdog&#x3D;0 in kernel command line<br>3)Or unset during compilation with</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_BOOTPARAM_HARDLOCKUP_PANIC=n</span><br></pre></td></tr></table></figure>

<p>From my experience, this kind of error is generally because of hardware issues as it’s impossible to disable interrupt in code level for so long time, I’ve never seen a software bug to trigger this error. You can check the bit9 of EFLAGS on the x86 platform if the interrupt is disabled or not when hitting a panic like this. The principle of it is because the value of hrtimer_interrupts doesn’t get updated as no interrupts can be routed to the kernel.</p>
<p>However, I’m not 100% sure if there is a software issue triggering an error like this. You need to analyze the panic info and kernel code accordingly.</p>
<h4 id="What-is-soft-lockup"><a href="#What-is-soft-lockup" class="headerlink" title="What is soft lockup?"></a>What is soft lockup?</h4><p>A ‘soft lockup’ is defined as a bug that causes the kernel to loop in kernel mode for more than 20 seconds, without giving other tasks a chance to run， which implies no scheduled events happened on a CPU. <a class="link"   target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/lockup-watchdogs.html" >[2]<i class="fas fa-external-link-alt"></i></a></p>
<p>From my experience, most soft lockups are triggered by holding busy locks for more than 20s, the most common type of it is spin lock. So just check the code of the function on the top of the call trace, and find out if there is a spin lock is hold for a long time.</p>
<p>I also saw another way says there are too many interrupts that can block schedule events. I’ve never seen such a case so far.</p>
<p>If you don’t want to panic your system when meeting soft lockup, you can disable the behavior with the following ways:</p>
<ol>
<li>disable panic at runtime over<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w kernel.softlockup_panic=0</span><br></pre></td></tr></table></figure></li>
<li>add softlockup_panic&#x3D;0 to kernel command line</li>
<li>disable panic during compilation of kernel over setting<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_BOOTPARAM_SOFTLOCKUP_PANIC=n</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-4-Task-hang"><a href="#2-4-Task-hang" class="headerlink" title="2.4 Task hang"></a>2.4 Task hang<a id="task_hang"></a></h3><p>A task hang implies a task&#x2F;process hasn’t been scheduled for a long time. The time value can be set with kernel.hung_task_timeout_secs.</p>
<p>Generally, the reason why a task&#x2F;process doesn’t get scheduled is because it waited on a list with TASK_UNINTERRUPTIBLE state for a long time. When you see the state of it over ps command like<br>“ps -eo pid,stat”</p>
<p>There would be a ‘D’, maybe also with other state signs. In this scenario, we can set the following kernel options to trigger a kernel panic and get a kernel core dump used to analyze more about it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysctl -a kernel.hung_task_panic=1</span><br><span class="line">sysctl -a kernel.hung_task_timeout_secs=120</span><br></pre></td></tr></table></figure>

<p>What we need to do with the kernel core dump is to check the wait list and the data inside of the relevant lock that is waited, and find out the owner of the lock, then see the stack trace of the owner and understand what it was doing at that moment.</p>
<h3 id="2-5-BUG-BUG-ON"><a href="#2-5-BUG-BUG-ON" class="headerlink" title="2.5 BUG&#x2F;BUG_ON"></a>2.5 BUG&#x2F;BUG_ON<a id="bug_macro"></a></h3><p>The BUG macro is to print some useful info first then, call panic() to crash kernel. The BUG_ON is to check a condition first, if it’s true then call BUG() macro. When hitting this situation, there would be a line with prefix “kernel  BUG at  …”, which is used to show you where the bug is from.</p>
<p>A real example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[ 2936.363067] kernel BUG at /home/rishi/doc_linux_kernel_workbook/doc/code/05_bug_reporting/01_bugon/mybugondriver.c:45!</span><br><span class="line">[ 2936.363101] invalid opcode: 0000 [#1] SMP</span><br><span class="line">[ 2936.363118] Modules linked in: mybugondriver(OE) ppdev vboxvideo ttm drm_kms_helper drm snd_intel8x0 fb_sys_fops snd_ac97_codec syscopyarea ac97_bus sysfillrect snd_pcm joydev sysimgblt input_leds snd_timer snd soundcore serio_raw i2c_piix4 parport_pc vboxguest 8250_fintek parport mac_hid ib_iser rdma_cm iw_cm ib_cm ib_sa ib_mad ib_core ib_addr iscsi_tcp libiscsi_tcp libiscsi scsi_transport_iscsi autofs4 btrfs raid10 raid456 async_raid6_recov async_memcpy async_pq async_xor async_tx xor raid6_pq libcrc32c raid1 raid0 multipath linear hid_generic usbhid hid crct10dif_pclmul crc32_pclmul ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd ahci psmouse libahci e1000 pata_acpi fjes video</span><br><span class="line">[ 2936.363407] CPU: 0 PID: 1766 Comm: bash Tainted: G OE 4.4.0-62-generic #83-Ubuntu</span><br><span class="line">[ 2936.363429] Hardware name: innotek GmbH VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006</span><br><span class="line">[ 2936.363451] task: ffff8800d8deb800 ti: ffff880035734000 task.ti: ffff880035734000</span><br><span class="line">[ 2936.363471] RIP: 0010:[&lt;ffffffffc03e618e&gt;] [&lt;ffffffffc03e618e&gt;] my_proc_write+0xae/0xc0 [mybugondriver]</span><br><span class="line">[ 2936.363501] RSP: 0018:ffff880035737e78 EFLAGS: 00010246</span><br><span class="line">[ 2936.363516] RAX: 0000000000000000 RBX: 0000000000000002 RCX: 00000000000032a5</span><br><span class="line">[ 2936.363535] RDX: 00000000000032a4 RSI: ffff88011b41a020 RDI: ffff880116801e00</span><br><span class="line">[ 2936.363553] RBP: ffff880035737e90 R08: 000000000001a020 R09: ffffffffc03e615c</span><br><span class="line">[ 2936.363572] R10: ffffea0004572b40 R11: 0000000000000239 R12: ffff880115cad950</span><br><span class="line">[ 2936.363592] R13: 0000000001189408 R14: 0000000000000002 R15: 0000000000000000</span><br><span class="line">[ 2936.363611] FS: 00007f4b6fc64700(0000) GS:ffff88011b400000(0000) knlGS:0000000000000000</span><br><span class="line">[ 2936.363633] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[ 2936.363648] CR2: 00007ffedb58b4b8 CR3: 00000000d597d000 CR4: 00000000000406f0</span><br><span class="line">[ 2936.363669] Stack:</span><br><span class="line">[ 2936.363676] ffff8800344a4a80 fffffffffffffffb ffff880035737f18 ffff880035737eb0</span><br><span class="line">[ 2936.363699] ffffffff8127bee2 ffff8800da934400 0000000001189408 ffff880035737ec0</span><br><span class="line">[ 2936.363723] ffffffff8120e168 ffff880035737f00 ffffffff8120eaf9 ffffffff810caeb1</span><br><span class="line">[ 2936.363746] Call Trace:</span><br><span class="line">[ 2936.363758] [&lt;ffffffff8127bee2&gt;] proc_reg_write+0x42/0x70</span><br><span class="line">[ 2936.363784] [&lt;ffffffff8120e168&gt;] __vfs_write+0x18/0x40</span><br><span class="line">[ 2936.363799] [&lt;ffffffff8120eaf9&gt;] vfs_write+0xa9/0x1a0</span><br><span class="line">[ 2936.364337] [&lt;ffffffff810caeb1&gt;] ? __raw_callee_save___pv_queued_spin_unlock+0x11/0x20</span><br><span class="line">[ 2936.365035] [&lt;ffffffff8120f7b5&gt;] SyS_write+0x55/0xc0</span><br><span class="line">[ 2936.365697] [&lt;ffffffff818385f2&gt;] entry_SYSCALL_64_fastpath+0x16/0x71</span><br><span class="line">[ 2936.366236] Code: f8 02 74 29 7e 20 83 f8 03 74 11 83 f8 04 75 11 48 c7 c7 e0 70 3e c0 e8 c5 6f da c0 e8 7c 1a 01 c1 48 89 d8 eb 9c 83 e8 01 75 f6 &lt;0f&gt; 0b 0f 0b 0f 1f 40 00 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 44</span><br><span class="line">[ 2936.367912] RIP [&lt;ffffffffc03e618e&gt;] my_proc_write+0xae/0xc0 [mybugondriver]</span><br><span class="line">[ 2936.368464] RSP &lt;ffff880035737e78&gt;</span><br><span class="line">[ 2936.369000] fbcon_switch: detected unhandled fb_set_par error, error code -16</span><br><span class="line">[ 2936.370289] fbcon_switch: detected unhandled fb_set_par error, error code -16</span><br><span class="line">[ 2936.371596] ---[ end trace 064cb0dbcc2892d3 ]---</span><br></pre></td></tr></table></figure>

<p>These two macros are generally added because an unexpected fatal error is happening. In other words, when the condition is true, there must be a BUG. So this situation is easy to understand where is wrong. You should check all the spots that might make the condition true.</p>
<h3 id="2-6-Kernel-stack-overflow"><a href="#2-6-Kernel-stack-overflow" class="headerlink" title="2.6 Kernel stack overflow"></a>2.6 Kernel stack overflow<a id="stack_overflow"></a></h3><p>A kernel stack is used to perform the code of kernel space. It’s 2 pages big on x86_64 arch. Generally, 2 pages are enough for any call patch in kernel. But there are always some bugs, so sometimes a stack operation might read&#x2F;write something beyond the boundary of kernel stack. Before VMAP_STACK got merged to mainline, it’s hard to track errors like this. With VMAP_STACK, we can get the notification when reading&#x2F;writing something to much on kernel stack</p>
<p>An example from <a class="link"   target="_blank" rel="noopener" href="https://access.redhat.com/solutions/6128111" >[3]<i class="fas fa-external-link-alt"></i></a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[ 6932.427010] BUG: stack guard page was hit at 00000000182b894e (stack is 0000000031e90a73..00000000d798f80a)</span><br><span class="line">[ 6932.427390] kernel stack overflow (double-fault): 0000 [#1] SMP NOPTI</span><br><span class="line">[ 6932.427730] CPU: 20 PID: 60530 Comm: qemu-kvm Kdump: loaded Tainted: G I --------- - - 4.18.0-240.10.1.el8_3.x86_64 #1</span><br><span class="line">[ 6932.428498] Hardware name: Dell Inc. PowerEdge R740/0WXD1Y, BIOS 2.10.2 02/24/2021</span><br><span class="line">[ 6932.429040] RIP: 0010:kvm_set_irq+0x46/0x130 [kvm]</span><br><span class="line">[ 6932.429528] Code: f3 48 81 ec d0 00 00 00 65 48 8b 04 25 28 00 00 00 48 89 84 24 c8 00 00 00 31 c0 0f 1f 44 00 00 4d 8d bd 40 30 02 00 4c 89 ff &lt;e8&gt; 95 f6 85 f9 44 89 f2 4c 89 ef 48 8d 74 24 08 89 44 24 04 e8 11</span><br><span class="line">[ 6932.430675] RSP: 0018:ffffab1800debf38 EFLAGS: 00010246</span><br><span class="line">[ 6932.431246] RAX: 0000000000000000 RBX: 0000000000000001 RCX: 0000000000000000</span><br><span class="line">[ 6932.431851] RDX: 000000000000000b RSI: 0000000000000001 RDI: ffffab17d9b64040</span><br><span class="line">[ 6932.432419] RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000</span><br><span class="line">[ 6932.432825] R10: ffff8c3f31f28000 R11: 0000000000000000 R12: 0000000000000000</span><br><span class="line">[ 6932.433157] R13: ffffab17d9b41000 R14: 000000000000000b R15: ffffab17d9b64040</span><br><span class="line">[ 6932.433488] FS: 00007fcb72fcd680(0000) GS:ffff8bc2bfa80000(0000) knlGS:0000000000000000</span><br><span class="line">[ 6932.433833] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033</span><br><span class="line">[ 6932.434173] CR2: ffffab1800debf28 CR3: 00000069fd808001 CR4: 00000000007626e0</span><br><span class="line">[ 6932.434516] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000</span><br><span class="line">[ 6932.434869] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400</span><br><span class="line">[ 6932.435213] PKRU: 55555554</span><br><span class="line">[ 6932.435556] Call Trace:</span><br><span class="line">[ 6932.435930] irqfd_resampler_ack+0x32/0x90 [kvm]</span><br><span class="line">[ 6932.436295] kvm_notify_acked_irq+0x5f/0xc0 [kvm]</span><br><span class="line">[ 6932.436652] kvm_ioapic_update_eoi_one.isra.10+0x3d/0x140 [kvm]</span><br><span class="line">[ 6932.437011] ioapic_set_irq+0x240/0x2d0 [kvm]</span><br><span class="line">[ 6932.437358] kvm_ioapic_set_irq+0x61/0x90 [kvm]</span><br><span class="line">[ 6932.437715] kvm_set_irq+0xa1/0x130 [kvm]</span><br><span class="line">[...snip...]</span><br><span class="line">[ 6932.525049] do_vfs_ioctl+0xa4/0x640</span><br><span class="line">[ 6932.525494] ksys_ioctl+0x60/0x90</span><br><span class="line">[ 6932.525888] __x64_sys_ioctl+0x16/0x20</span><br><span class="line">[ 6932.526282] do_syscall_64+0x5b/0x1a0</span><br><span class="line">[ 6932.526703] entry_SYSCALL_64_after_hwframe+0x65/0xca</span><br><span class="line">[ 6932.527099] RIP: 0033:0x7fcb6dcbd88b</span><br><span class="line">[ 6932.527493] Code: 0f 1e fa 48 8b 05 fd 95 2c 00 64 c7 00 26 00 00 00 48 c7 c0 ff ff ff ff c3 66 0f 1f 44 00 00 f3 0f 1e fa b8 10 00 00 00 0f 05 &lt;48&gt; 3d 01 f0 ff ff 73 01 c3 48 8b 0d cd 95 2c 00 f7 d8 64 89 01 48</span><br><span class="line">[ 6932.528233] RSP: 002b:00007ffc904196b8 EFLAGS: 00000246 ORIG_RAX: 0000000000000010</span><br><span class="line">[ 6932.528655] RAX: ffffffffffffffda RBX: 000055721dcba5c0 RCX: 00007fcb6dcbd88b</span><br><span class="line">[ 6932.528940] RDX: 00007ffc90419720 RSI: ffffffffc008ae67 RDI: 0000000000000017</span><br><span class="line">[ 6932.529213] RBP: 0000000000000001 R08: 000000000000000b R09: 000000000000002c</span><br><span class="line">[ 6932.529487] R10: 00007fcb6df87ba0 R11: 0000000000000246 R12: 000000000000000b</span><br><span class="line">[ 6932.529772] R13: 0000000000000001 R14: 000055721c08f770 R15: 000055721dc23854</span><br></pre></td></tr></table></figure>

<p>For this situation, we need to disassemble the last function. Here it’s kvm_set_irq(). Find out which parameter&#x2F;data is incorrect. But not all scenarios are caused by software issues. I’ve ever seen an issue that over the boundary of stack is because a “rep mov” instruction was performed once more than expected. Then a kernel stack overflow was reported. This issue turned out to be an issue from intel ucode.</p>
<h3 id="2-7-RCU-stall"><a href="#2-7-RCU-stall" class="headerlink" title="2.7 RCU stall"></a>2.7 RCU stall<a id="rcu_stall"></a></h3><p>This type of panic is quite complex. There are some reasons to cause the panic. You can reference <a class="link"   target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/RCU/stallwarn.txt" >[4]<i class="fas fa-external-link-alt"></i></a> to learn more. My knowledge about rcu stall is still not enough, will update later. To generate a panic during rc stall, you can set the option below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w kernel.panic_on_rcu_stall=1</span><br></pre></td></tr></table></figure>

<h3 id="2-8-double-fault"><a href="#2-8-double-fault" class="headerlink" title="2.8 double fault"></a>2.8 double fault<a id="double_fault"></a></h3><p>Will update later.</p>
<p>Note that a panic for hard&#x2F;soft lockup and hung tasks is not necessary. It depends on how you use your OS. Generally, A high availability system needs this kind of panic. Otherwise, the panic will break downyou system. So you should enable panic for these scenarios accordingly.</p>
<h2 id="3-The-necessary-knowledge-for-understanding-a-panic-in-code-level"><a href="#3-The-necessary-knowledge-for-understanding-a-panic-in-code-level" class="headerlink" title="3 The necessary knowledge for understanding a panic in code level"></a>3 The necessary knowledge for understanding a panic in code level<a id="ns_knowledge"></a></h2><ol>
<li>Understand the principle of each panic type. Aware of why the kernel generates such a panic. Then you might get a chance to fix it.</li>
<li>Aware of call convention on the CPU archs you work on. When disassembling a function, to understand how a variable is passed and operated, you need to know how registers are used in the platform you are working on.  For example, on the x86_64 the caller uses registers to pass the first 6 arguments to the callee. Given the arguments in left-to-right order, the order of registers used is: %rdi, %rsi, %rdx, %rcx, %r8, and %r9. Any remaining arguments are passed on the stack in reverse order so that they can be popped off the stack in order<a class="link"   target="_blank" rel="noopener" href="http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order." >[5]<i class="fas fa-external-link-alt"></i></a>.</li>
<li>Aware of stack layout. To understand disassembly better, you need to know which bytes are used to save the prior %rpb value, return address, local variables, etc.</li>
<li>You have to be familiar with the code style of kernel.</li>
<li>Learn how to use crash tool, some useful subcommands like disassemble, kmem, list, etc.</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:<a id="reference"></a></h2><p>[1] <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kernel_panic" >https://en.wikipedia.org/wiki/Kernel_panic<i class="fas fa-external-link-alt"></i></a><br>[2] <a class="link"   target="_blank" rel="noopener" href="https://docs.kernel.org/admin-guide/lockup-watchdogs.html" >https://docs.kernel.org/admin-guide/lockup-watchdogs.html<i class="fas fa-external-link-alt"></i></a><br>[3] <a class="link"   target="_blank" rel="noopener" href="https://access.redhat.com/solutions/6128111" >https://access.redhat.com/solutions/6128111<i class="fas fa-external-link-alt"></i></a><br>[4] <a class="link"   target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/RCU/stallwarn.txt" >https://www.kernel.org/doc/Documentation/RCU/stallwarn.txt<i class="fas fa-external-link-alt"></i></a><br>[5]<a class="link"   target="_blank" rel="noopener" href="http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order" >http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html#:~:text=Calling%20Convention&amp;text=The%20caller%20uses%20registers%20to,off%20the%20stack%20in%20order<i class="fas fa-external-link-alt"></i></a>.</p>

                    
                </div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2025/01/06/kernel/read_assembly_on_x86_64/"
                                   title="How to read assembly and stack data on x86_64"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">How to read assembly and stack data on x86_64</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2020/01/01/About_me/"
                                   title="Welcome to my home page!"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">Welcome to my home page!</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2025
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Keep Team</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    

    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    

    <!-- tablet toc -->
    
</main>





<!-- common js -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local search -->


<!-- lazyload -->


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
